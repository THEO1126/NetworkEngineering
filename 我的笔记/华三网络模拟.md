

# 华三网络模拟

工程路径：

`C:\Users\libbing\HCL\Projects`

## 隔离

`port-isolate` 和 `vlan-isolate` 是两种不同的网络隔离机制，它们在华三（H3C）交换机上提供了不同的功能和应用场景。下面我将详细解释这两种隔离方式的区别：

### 1. Port Isolation (端口隔离)

- **定义**：端口隔离是一种二层安全特性，它允许您在同一VLAN内隔离某些端口，使得这些端口之间的流量不能直接互通，但它们仍然可以与网关等三层设备通信。
    
- **作用范围**：同一VLAN内的指定端口之间。
    
- **配置粒度**：基于单个端口或一组端口。
    
- **主要用途**：
    
    - 提高安全性：防止同一VLAN内的用户直接相互通信，减少潜在的安全风险。
        
    - 防止广播风暴：限制不必要的广播流量在特定端口之间传播。
        
    - 应用场景：宿舍、酒店、公共无线接入点等环境，其中每个用户应该被隔离以确保隐私和安全。
        
- **配置示例**：
    
    [H3C] interface GigabitEthernet 1/0/2  
    [H3C-GigabitEthernet1/0/2] port-isolate enable group 1
    

### 2. VLAN Isolation (VLAN隔离)

- **定义**：VLAN隔离通常指的是创建多个VLAN，并将不同的设备分配到不同的VLAN中。不同VLAN之间的流量是完全隔离的，除非通过三层设备（如路由器或三层交换机）进行路由。
    
- **作用范围**：不同VLAN之间。
- **配置粒度**：基于整个VLAN。
- **主要用途**：
    
    - 网络分段：将网络划分为多个逻辑子网，每个子网对应一个VLAN，从而提高网络性能和管理效率。
    - 安全性增强：不同VLAN之间的流量默认是隔离的，增加了安全性。
    - 流量控制：通过为不同类型的流量分配不同的VLAN，可以更好地管理和优化网络资源。
    - 应用场景：企业网络、数据中心等环境中，用于实现部门间的网络隔离、访客网络、服务器集群等。
        
- **配置示例**： 创建VLAN并为端口分配VLAN：
    
    [H3C] vlan 10  
    [H3C-vlan10] quit  
    [H3C] interface GigabitEthernet 1/0/2  
    [H3C-GigabitEthernet1/0/2] port link-type access  
    [H3C-GigabitEthernet1/0/2] port default vlan 10
    

### 主要区别

- **隔离级别**：
    
    - ##### `port-isolate` 是在同一个VLAN内进行更细粒度的隔离，适用于需要在同一VLAN内进一步隔离端口的场景。
    - `vlan-isolate` 是通过创建不同的VLAN来实现更大范围的隔离，适用于需要完全隔离不同部门或服务的场景。
- **流量路径**：
    
    - `port-isolate` 允许隔离的端口与三层设备通信，但不允许它们直接相互通信。
    - `vlan-isolate` 不同VLAN之间的流量默认是隔离的，除非通过三层设备进行路由。
- **配置复杂度**：
    
    - `port-isolate` 的配置相对简单，只需要针对特定端口启用即可。
    - `vlan-isolate` 涉及到创建和管理多个VLAN，可能需要更复杂的配置，特别是当涉及到跨VLAN的路由时。
- ##### **应用场景**：
    
    - `port-isolate` 适合于需要在同一VLAN内提供更高安全性和性能的场景，如公共Wi-Fi、学生宿舍等。
    - `vlan-isolate` 适合于需要严格分离不同业务或部门的流量，如企业内部网络、数据中心等。


### 总结

选择使用 `port-isolate` 还是 `vlan-isolate` 取决于您的具体需求和网络架构。如果您需要在同一VLAN内进一步隔离端口，`port-isolate` 是一个很好的选择；如果您需要完全隔离不同的业务或部门，`vlan-isolate` 则更为合适。根据实际情况，有时也可能结合使用这两种技术，以达到最佳的网络管理和安全性。

**注意事项**

- 端口隔离只在同一个VLAN内有效。不同VLAN的端口天然就是隔离的。
- 被隔离的端口之间不能直接相互通信，但可以与网关或其他三层设备通信。
- 如果您有多个需要隔离的端口，需要分别对每个端口执行上述配置命令。
- 确保您的网络设计和需求确实需要使用端口隔离，因为这可能会改变网络的拓扑结构和流量路径。
- 在多用户环境下进行此类配置时，请小心操作，**以免影响现有服务**

### 实验命令

```shell
<H3C> display vlan  # 查看端口的VLAN配置  
<H3C> display vlan 10 # 查看特定VLAN的信息  
<H3C> display interface GigabitEthernet 1/0/1  # 查看某个特定端口的详细VLAN配置  
<H3C> display port vlan # 查看端口与VLAN的映射关系  
<H3C> display brief  #查看端口的简要信息  
display port-group-vlan all  # 显示端口组 VLAN 的信息。
```

**端口隔离**

要在华三（H3C）交换机上使用 port-isolate 命令将端口1（例如 GigabitEthernet 1/0/1）和端口2（例如 GigabitEthernet 1/0/2）隔离，您需要分别在这两个端口上启用端口隔离功能，并将它们分配到同一个隔离组。这样做的结果是，这两个端口之间的流量将被隔离，但它们仍然可以与不属于该组的其他端口或三层设备通信。

```shell
display port-isolate group # 显示隔离组中的信息  
[H3C] display port-isolate  # 查看所有端口隔离状态  
[H3C] interface GigabitEthernet 1/0/1  
[H3C-GigabitEthernet1/0/1] port-isolate enable group 1  # 当前端口启用端口隔离功能，并加入指定端口组  
[H3C] interface GigabitEthernet 1/0/2  
[H3C-GigabitEthernet1/0/2] port-isolate enable group 1  # 当前端口启用端口隔离功能，并加入指定端口组  
[H3C-GigabitEthernet1/0/2] undo port-isolate enable # 从端口隔离组移除
```
**vlan划分**

```shell
[H3C]vlan 2 # 创建vlan2  
[H3C-GigabitEthernet1/0/2]port link-type access  # 更改端口类型  
[H3C-GigabitEthernet1/0/2]port access vlan 2  #当前端口规划成vlan2  
[H3C]interface Vlan-interface 2 # 进入vlan2视图
```

## vlan 互通

不同vlan互通

```shell
vlan 2  # 创建vlan2  
interface Vlan-interface 2   
ip address 192.168.2.1 24   # 为 VLAN 接口配置 IP 地址（即网关地址）  
undo shutdown # 启用接口（确保接口处于活动状态）  
vlan 3  
interface Vlan-interface 3  
ip address 192.168.3.1 24  
#（可选）配置路由（如果需要）  
# 如果您有多个VLAN或需要与外部网络通信，可能需要配置静态路由或启用动态路由协议。例如，配置一条静态路由到默认网关：  
# 配置静态路由：  
[H3C] ip route-static 0.0.0.0 0.0.0.0 <下一跳IP地址>  
# 其中 <下一跳IP地址> 是您的上游路由器或网关的IP地址。

```


**同一个VLAN下实现不同网段的互通**

如果您的交换机支持三层功能（如华三H3C的三层交换机），您可以为同一个物理VLAN创建多个逻辑子接口，并为每个子接口分配不同的IP子网。然后，配置这些子接口之间的路由，使得不同网段的设备能够相互通信。

```shell
# 从 VLAN 10 到 VLAN 20 的静态路由：  
[H3C] ip route-static 192.168.20.0 255.255.255.0 192.168.10.1  
# 查看路由表  
[H3C] display ip routing-table 

display ip interface brief #命令查看所有接口的IP地址配置情况

```

1. **查看当前生效的静态路由**：使用`display ip routing-table protocol static`命令。这个命令会显示所有当前生效的静态路由信息，包括目的地址、子网掩码、下一跳地址等。
    
2. **查看设备上的静态路由配置**：使用`display cu | include route-static`命令。这个命令会显示设备上所有关于静态路由的配置，包括已添加的静态路由条目。

## NAT配置

### NAT 配置上网

```shell
#  开启DNS协议的ALG功能。  
[R] nat alg dns  
# 配置ACL 2000，允许对内部网络中192.168.10.0/24  192.168.20.0/24网段的报文进行地址转换。  
[R] acl number 2000  
 [R-acl-adv-3000] rule permit ip source 192.168.10.0 0.0.0.255  
 [R-acl-adv-3000] rule permit ip source 192.168.20.0 0.0.0.255  
 [R-acl-adv-3000] quit  
# 进入接口，连接到一个外部网络（如互联网）的接口。  
 [R] int g0/0  
# 这条命令应用之前定义的ACL 2000到接口GigabitEthernet 0/0的出站NAT上  
 [R-g0/0] nat outbound 2000
```

这段配置是在一个路由器（标记为[R]）上进行的，目的是配置一个高级访问控制列表（ACL）和基于该ACL的出站网络地址转换（NAT）。下面是配置步骤的解释：

1. 创建ACL 3000
    - `[R] acl number 3000`：这条命令开始创建一个编号为3000的ACL。
2. 定义ACL规则
    - `[R-acl-adv-3000] rule permit ip source 192.168.10.0 0.0.0.255`：这条规则允许源IP地址为192.168.10.0到192.168.10.255的IP数据包通过。这里的`0.0.0.255`是一个子网掩码，表示前24位是网络地址，后8位是主机地址范围（子网掩码的反码）。
    - `[R-acl-adv-3000] rule permit ip source 192.168.20.0 0.0.0.255`：这条规则允许源IP地址为192.168.20.0到192.168.20.255的IP数据包通过，与上一条规则类似，使用`0.0.0.255`作为子网掩码。
3. 退出ACL配置模式
    - `[R-acl-adv-3000] quit`：这条命令结束ACL 3000的配置，返回到全局配置模式。
4. 配置出站NAT
    - `[R] int g0/1`：这条命令进入接口GigabitEthernet 0/1的配置模式。这个接口很可能是连接到一个外部网络（如互联网）的接口。
    - `[R-g0/1] nat outbound 3000`：这条命令应用之前定义的ACL 3000到接口GigabitEthernet 0/1的出站NAT上。这意味着所有符合ACL 3000规则的出站IP数据包（即源IP在192.168.10.0/24或192.168.20.0/24范围内的数据包）都将被进行NAT转换，通常是将它们的源IP地址转换为路由器外部接口的IP地址（或者某个指定的公网IP地址），以便这些数据包可以在互联网上正确路由。

总结来说，这段配置的目的是允许特定内部网络（192.168.10.0/24和192.168.20.0/24）的IP数据包通过路由器的GigabitEthernet 0/1接口进行出站NAT转换，以便它们可以访问外部网络（如互联网）。

### NAT配置访问特定外网

```shell
# 按照组网图配置各接口的IP地址，具体配置过程略。  
​  
# 开启DNS协议的ALG功能。  
<Router> system-view  
[Router] nat alg dns  
# 配置ACL 2000，允许对内部网络中192.168.1.0/24网段的报文进行地址转换。  
[Router] acl basic 2000  
[Router-acl-ipv4-basic-2000] rule permit source 192.168.1.0 0.0.0.255  
[Router-acl-ipv4-basic-2000] quit  
​  
# 创建地址组1。  
[Router] nat address-group 1  
# 添加地址组成员202.38.1.2。  
[Router-address-group-1] address 202.38.1.2              
[Router-address-group-1] quit  
​  
# 创建地址组2。  
[Router] nat address-group 2  
# 添加地址组成员202.38.1.3。  
[Router-address-group-2] address 202.38.1.3  
[Router-address-group-2] quit    
​  
# 在接口GigabitEthernet0/0/2上配置NAT内部服务器，允许外网主机使用地址202.38.1.4访问内网DNS服务器。  
[Router] interface gigabitethernet 0/0/2  
[Router-GigabitEthernet0/0/2] nat server protocol udp global 202.38.1.4 inside 192.168.1.3 dns  
# 在接口GigabitEthernet0/0/2上配置出方向动态地址转换，允许使用地址组1中的地址对DNS应答报文载荷中的内网地址进行转换，并在转换过程中不使用端口信息，以及允许反向地址转换。  
[Router-GigabitEthernet0/0/2] nat outbound 2000 address-group 1 no-pat reversible  
# 在接口GigabitEthernet0/0/2上配置入方向动态地址转换，允许使用地址组2中的地址对外网访问内网的报文进行源地址转换，并在转换过程中使用端口信息。  
[Router-GigabitEthernet0/0/2] nat inbound 2000 address-group 2  
​  
# 配置到达202.38.1.3地址的静态路由，出接口为GigabitEthernet0/0/2，下一跳地址为20.2.2.2（20.2.2.2为本例中的直连下一跳地址，实际使用中请以具体组网情况为准）。  
[Router] ip route-static 202.38.1.3 32 gigabitethernet 0/0/2 20.2.2.2  
​
```