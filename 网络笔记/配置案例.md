
## Vlan配置互通

[VLAN典型配置 - S300, S500, S2700, S3700, S5700, S6700, S7700, S7900, S9700系列交换机 典型配置案例（V200） - 华为](https://support.huawei.com/enterprise/zh/doc/EDOC1000069491/b699322c)

### 1、配置基于接口划分VLAN示例（接入层设备作为网关）

![[Vlan互通配置-三层交换机.jpg]]
❗**通过在三层交换机中，配置三层网关路由实现互通**

三层交换机
```shell
# 创建VLAN，进入vlan视图，设置vlan的三层网关路由
[Huawei]vlan 10
[Huawei-vlan10]interface vlan 10
[Huawei-Vlanif10]ip address 192.168.10.1 255.255.255.0
[Huawei]vlan 20
[Huawei-vlan20]interface vlan 20
[Huawei-Vlanif20]ip address 192.168.20.1 255.255.255.0
[Huawei]vlan 100
[Huawei]interface vlan 100
[Huawei-Vlanif100]ip address 192.168.100.1 255.255.255.0

# 进入接口，配置为trunk接口并加入vlan中
[Huawei]interface GigabitEthernet 0/0/1
[Huawei-GigabitEthernet0/0/1]port link-type trunk
[Huawei-GigabitEthernet0/0/1]port trunk allow-pass vlan 10

[Huawei]interface GigabitEthernet 0/0/2
[Huawei-GigabitEthernet0/0/2]port link-type trunk
[Huawei-GigabitEthernet0/0/2]port trunk allow-pass vlan 20

# 进入接口，配置为access接口并加入vlan中
[Huawei]port-group 2
[Huawei-port-group-2]group-member GigabitEthernet 0/0/3 to GigabitEthernet 0/0/4
[Huawei-port-group-2]port link-type access
[Huawei-port-group-2]port default vlan 100

# 进入接口，配置为trunk接口，并放行所有的vlan
[Huawei]interface GigabitEthernet 0/0/5
[Huawei-GigabitEthernet0/0/5]port link-type trunk
[Huawei-GigabitEthernet0/0/5]port trunk allow-pass vlan all
```

二层交换机A  
```shell
# 创建VLAN
[Huawei]vlan 10

# 进入接口，配置为access接口并加入vlan中
[Huawei]interface GigabitEthernet 0/0/1
[Huawei-GigabitEthernet0/0/1] port link-type access
[Huawei-GigabitEthernet0/0/1]port default vlan 10

# 进入接口，配置为access接口并加入vlan中
[Huawei]interface GigabitEthernet 0/0/2
[Huawei-GigabitEthernet0/0/2] port link-type access
[Huawei-GigabitEthernet0/0/2]port default vlan 10

# 进入接口，配置为trunk接口，并放行所有的vlan
[Huawei]interface GigabitEthernet 0/0/3
[Huawei-GigabitEthernet0/0/3]port link-type trunk
[Huawei-GigabitEthernet0/0/3]port trunk allow-pass vlan all
```


二层交换机B
```shell
# 创建VLAN
[Huawei]vlan 20

# 进入接口，配置为access接口并加入vlan中
[Huawei]interface GigabitEthernet 0/0/1
[Huawei-GigabitEthernet0/0/1] port link-type access
[Huawei-GigabitEthernet0/0/1]port default vlan 20

# 进入接口，配置为access接口并加入vlan中
[Huawei]interface GigabitEthernet 0/0/2
[Huawei-GigabitEthernet0/0/2] port link-type access
[Huawei-GigabitEthernet0/0/2]port default vlan 20

# 进入接口，配置为trunk接口，并放行所有的vlan
[Huawei]interface GigabitEthernet 0/0/3
[Huawei-GigabitEthernet0/0/3]port link-type trunk
[Huawei-GigabitEthernet0/0/3]port trunk allow-pass vlan all
```



## 静态路由

[静态路由典型配置 - S300, S500, S2700, S3700, S5700, S6700, S7700, S7900, S9700系列交换机 典型配置案例（V200） - 华为](https://support.huawei.com/enterprise/zh/doc/EDOC1000069491/743f6e24)

![[静态路由配置-二层交换机.png]]

❗**通过配置静态路由实现互通**
ip route-static {目的地址} {子网掩码} {下一跳}

**二层交换机**
```shell
#
interface Vlanif11
 ip address 192.168.11.2 255.255.255.252 
#
interface Vlanif12
 ip address 192.168.11.6 255.255.255.252 
#
interface Vlanif13
 ip address 192.168.11.10 255.255.255.252 
#
interface GigabitEthernet0/0/1
 port link-type trunk
 port trunk allow-pass vlan 11
#
interface GigabitEthernet0/0/2
 port link-type trunk
 port trunk allow-pass vlan 12
#
interface GigabitEthernet0/0/3
 port link-type trunk
 port trunk allow-pass vlan 13
#
ip route-static 192.168.10.0 255.255.255.0 192.168.11.1
ip route-static 192.168.20.0 255.255.255.0 192.168.11.5
ip route-static 192.168.30.0 255.255.255.0 192.168.11.9
```


**AC1**
```shell
#
interface Vlanif10
 ip address 192.168.10.1 255.255.255.0
 dhcp select interface
#
interface Vlanif11
 ip address 192.168.11.1 255.255.255.252
#
interface GigabitEthernet0/0/1
 port link-type trunk
 port trunk allow-pass vlan 10 11
#
interface GigabitEthernet0/0/2
 port link-type access
 port default vlan 10
#
interface GigabitEthernet0/0/3
 port link-type access
 port default vlan 10
#
interface GigabitEthernet0/0/4
 port link-type access
 port default vlan 10
#
ip route-static 0.0.0.0 0.0.0.0 192.168.11.2
```

**AC2**

```shell
#
interface Vlanif12
 ip address 192.168.11.5 255.255.255.252
#
interface Vlanif20
 ip address 192.168.20.1 255.255.255.0
 dhcp select interface
#
interface GigabitEthernet0/0/1
 port link-type trunk
 port trunk allow-pass vlan 12 20
#
interface GigabitEthernet0/0/2
 port link-type access
 port default vlan 20
#
interface GigabitEthernet0/0/3
 port link-type access
 port default vlan 20
#
interface GigabitEthernet0/0/4
 port link-type access
 port default vlan 20
#
ip route-static 0.0.0.0 0.0.0.0 192.168.11.6
```

**AC3**
```shell
#
interface Vlanif13
 ip address 192.168.11.9 255.255.255.252
#
interface Vlanif30
 ip address 192.168.30.1 255.255.255.0
 dhcp select interface
#
interface GigabitEthernet0/0/1
 port link-type trunk
 port trunk allow-pass vlan 13 30
#
interface GigabitEthernet0/0/2
 port link-type access
 port default vlan 30
#
interface GigabitEthernet0/0/3
 port link-type access
 port default vlan 30
#
interface GigabitEthernet0/0/4
 port link-type access
 port default vlan 30
#
ip route-static 0.0.0.0 0.0.0.0 192.168.11.10
```

# 四、故障排查

## 环路故障

[华为eNSP：二层环路与STP实验-CSDN博客](https://blog.csdn.net/nankon_/article/details/138996942)

